```sheet
|  ▷▶▷▶ Query 실행 순서 ▷▶▷▶  | < | < | < | < | < | < | < | < | < |
| :----: | :------: | :---------------: | :------: | :------------: | :------: | :---------------: | :------: | :------------: | :------------: |
|  [With](1.%20With)  |   [From](2.%20From%20&%20Join)   |       [Where](3.%20Where%20&%20Group%20By%20&%20Having#^where)       | [Group by](3.%20Where%20&%20Group%20By%20&%20Having#^groupby) |     [Having](3.%20Where%20&%20Group%20By%20&%20Having#^having)     | [Select](4.%20Select) | [Distinct](연산자#^distinct) | [Union / Union all](연산자#^union) | [Order by](5.%20Order%20By%20&%20Offset%20&%20Limit#^orderby) | [Offset](5.%20Order%20By%20&%20Offset%20&%20Limit#^offset) / [Limit](5.%20Order%20By%20&%20Offset%20&%20Limit#^limit) |
```
 - **윈도우 함수**
	 - 집계 함수 , 수학 함수 , 순위 함수 등을 사용하여 특정 값을 출력하기 위해 사용
	 - Filter (where )
		 - Over () 집계형태에 조건을 부여하기 위해 사용
		 - `SUM(salary) FILTER (WHERE bonus > 0) OVER (ORDER BY hire_date)`
	 - OVER ()
		 - https://schatz37.tistory.com/3
		 - 복잡한 분석 및 집계상황 (대용량 DB) 에서 사용 특정된 단순한 목적을 출력하고자 하면 Sub Query 사용이 최적
			 - Count, Sum, Avg 등
			 - `row_number() over(partition by A order by B)`
			 - Partition By
				 - ~ Over (partition by ~ )
					◊ `max( A Column ) over (partition by B Column)`
					◊ B Column 을 그룹화 하고 해당 그룹의 A Column max 값을 출력  
				 - 데이터를 파티션으로 나누기 위한 열 목록
			 - Order By
				 - ~ Over (order by ~ )
				 - 데이터를 정렬하기 위한 열 목록
			 - ETC
				 - 필요에 따라 추가 옵션 지정
		 - https://miraekwak.tistory.com/188

<p></p>

 - **함수 중첩 활용**
	 - Self-Join 보다 낮은 Cost
	 - 안쪽 : 집계 함수
	 - 바깥쪽 : 윈도우 함수 (집계 함수 , 수학 함수 , 순위 함수)
	 - 누적 집계
		 - `sum(d.quantityordered*d.priceeach) as price` => 해당제품매출 > 안쪽
		 - `sum(sum(d.quantityordered*d.priceeach)) over(partition by p.productline) as all_price` => 제품라인전체매출
			 - 해당제품매출 값을 제품라인으로 파티션 정렬하여 제품라인전체매출 값 계산
			 - Over() 을 사용하여 재정렬하지 않으면 바깥쪽 집계 함수를 계산 불가
	 - 평균 편차
		 - `AVG(buyPrice) as unit_price` => 해당 제품 평균가
		 - `AVG(AVG(buyPrice)) OVER(PARTITION BY productLine) as line_avg_price` => 해당 제품 라인의 전체 평균가
		 - `AVG(buyPrice) - AVG(AVG(buyPrice)) OVER(PARTITION BY productLine) as price_diff` => 평균과의 차이 (편차) 계산
	 - 전체 대비 비중
		 - `SUM(quantityInStock) as stock_qty`
		 - `ROUND(SUM(quantityInStock) / SUM(SUM(quantityInStock)) OVER(PARTITION BY productLine) * 100, 2) as ratio_in_line` => 해당 라인 내에서의 비중
		 - `ROUND(SUM(quantityInStock) / SUM(SUM(quantityInStock)) OVER() * 100, 2) as ratio_in_total` => 전사(Total) 재고 대비 비중
	 - 집계 순위 (상위 0% ~ 하위 100%)
		 - `SUM(amount) as total_payment` => 지불 총액
		 - `RANK() OVER(ORDER BY SUM(amount) DESC) as payment_rank` => 지불 총액 기준 순위
		 - `(PERCENT_RANK() OVER(ORDER BY SUM(amount) DESC) * 100) as percentile` => 지불 총액 기준 누적 백분율 순위 (상위 몇 %인가?)
		 - `SUM(quantityOrdered) as total_sold` => 판매량 합계
		 - `NTILE(5) OVER(ORDER BY SUM(quantityOrdered) DESC) as sales_grade` => 판매량 합계를 기준으로 전체 제품을 5개의 그룹으로 등급화 (1등급 ~ 5등급)
